# R 버전 역량진단 요인분석 스크립트

MATLAB 코드를 R로 변환한 시점별 개별 요인분석 기반 역량진단 성과점수 산출 및 성과기여도 상관분석 스크립트입니다.

## 📋 주요 기능

- **수평 진단 데이터 처리**: 동료 평가 점수를 개인별로 평균하여 하향 진단 형태로 변환
- **시점별 개별 요인분석**: 4개 시점(23년 하반기 ~ 25년 상반기) 각각에 대해 독립적인 요인분석 수행
- **다중 기준 요인 수 결정**: Kaiser, Scree plot, Parallel Analysis를 통한 최적 요인 수 선택
- **성과 요인 자동 식별**: 키워드 매칭을 통한 성과 관련 요인 자동 식별
- **데이터 품질 검증**: 상관행렬 조건수, 행렬식 등을 통한 데이터 품질 평가
- **성과기여도 상관분석**: 역량진단 점수와 성과기여도 간의 상관관계 분석
- **Excel 결과 저장**: 다중 시트로 구성된 상세한 분석 결과 저장

## 🚀 설치 및 실행

### 1. R 설치
- R 4.0 이상 버전 설치 (https://www.r-project.org/)
- RStudio 설치 권장 (https://www.rstudio.com/)

### 2. 패키지 설치
```r
# 패키지 설치 스크립트 실행
source("install_packages.R")
```

### 3. 데이터 준비
다음 경로에 데이터 파일들이 있어야 합니다:
```
D:/project/HR데이터/데이터/역량진단 데이터/역량진단_응답데이터/
├── 23년_하반기_역량진단_응답데이터.xlsx
├── 24년_상반기_역량진단_응답데이터.xlsx
├── 24년_하반기_역량진단_응답데이터.xlsx
└── 25년_상반기_역량진단_응답데이터.xlsx

D:/project/HR데이터/데이터/역량검사 요청 정보/
└── 최근 3년 입사자_인적정보.xlsx
```

### 4. 스크립트 실행
```r
# 메인 분석 스크립트 실행
source("factor_analysis_by_period_peer_cc.R")
```

## 📊 출력 결과

### Excel 파일
- **수평진단_종합분석결과_YYYYMMDD_HHMMSS.xlsx**
  - `역량진단_통합점수`: 전체 참여자의 시점별 성과점수
  - `{시점}_점수`: 각 시점별 개인별 성과점수 및 요인별 점수
  - `{시점}_부하량`: 각 시점별 요인 부하량 매트릭스
  - `성과기여도점수`: 반기별 성과기여도 점수
  - `상관분석_통합데이터`: 역량진단과 성과기여도 매칭 데이터
  - `상관분석결과`: 시점별 상관분석 결과 요약

### 로그 파일
- **D:/project/matlab_runlog/runlog_horizontal_enhanced_R.txt**: 상세한 실행 로그

## 🔧 주요 R 패키지

| 패키지 | 용도 |
|--------|------|
| `readxl` | Excel 파일 읽기 |
| `dplyr`, `tidyr` | 데이터 처리 및 정리 |
| `psych` | 요인분석, KMO, Cronbach's alpha |
| `corpcor` | 상관행렬 처리 |
| `openxlsx` | Excel 파일 쓰기 |
| `ggplot2` | 시각화 |
| `corrplot` | 상관행렬 시각화 |
| `VIM` | 결측값 처리 |

## 📈 분석 과정

1. **데이터 로드**: 4개 시점의 수평 진단 데이터 로드
2. **데이터 변환**: 동료 평가 → 개인별 평균 → 하향 진단 형태 변환
3. **전처리**: 상수 열 제거, 다중공선성 처리, 극단값 조정, 저분산 문항 제거
4. **품질 검사**: 상관행렬 조건수, 행렬식 등을 통한 데이터 품질 평가
5. **요인분석**: Promax 회전을 사용한 요인분석 수행
6. **성과 요인 식별**: 키워드 매칭을 통한 성과 관련 요인 자동 식별
7. **점수 산출**: 0-100 스케일로 성과점수 변환
8. **성과기여도 분석**: 분기별 성과기여도 점수 계산 및 반기별 집계
9. **상관분석**: 역량진단 점수와 성과기여도 간의 상관관계 분석
10. **결과 저장**: Excel 파일로 상세한 분석 결과 저장

## ⚠️ 주의사항

- **데이터 경로**: 스크립트 내의 파일 경로를 실제 환경에 맞게 수정 필요
- **메모리 사용량**: 대용량 데이터 처리 시 충분한 메모리 확보 필요
- **실행 시간**: 전체 분석 완료까지 수분~수십분 소요 가능
- **한글 인코딩**: Windows 환경에서 한글 파일명 처리 시 주의

## 🆚 MATLAB vs R 비교

| 기능 | MATLAB | R |
|------|--------|---|
| **비용** | 유료 라이선스 필요 | 무료 오픈소스 |
| **요인분석** | `factoran()` | `psych::fa()` |
| **데이터 처리** | 테이블 연산 | `dplyr` 파이프라인 |
| **Excel 처리** | `readtable()`, `writetable()` | `readxl`, `openxlsx` |
| **시각화** | 기본 플롯 | `ggplot2` |
| **성능** | 빠른 행렬 연산 | 패키지 의존적 |
| **재현성** | 스크립트 기반 | R Markdown 지원 |

## 🐛 문제 해결

### 패키지 설치 오류
```r
# 개별 패키지 설치
install.packages("패키지명", dependencies = TRUE)

# 또는 BiocManager 사용
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("패키지명")
```

### 메모리 부족 오류
```r
# 메모리 사용량 확인
memory.size()
memory.limit()

# 가비지 컬렉션 실행
gc()
```

### 한글 인코딩 문제
```r
# 로케일 설정
Sys.setlocale("LC_ALL", "Korean")

# 또는 파일 읽기 시 인코딩 지정
read_excel("파일명.xlsx", locale = locale(encoding = "UTF-8"))
```

## 📞 지원

- R 공식 문서: https://www.r-project.org/help.html
- 패키지 문서: `help(패키지명)` 또는 `?함수명`
- 스택오버플로우: https://stackoverflow.com/questions/tagged/r

---

**작성일**: 2025년  
**버전**: 1.0  
**언어**: R 4.0+
