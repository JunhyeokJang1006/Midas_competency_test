%% ========================================================================
%         ì†Œí™”ì„± ì¸ì¬ íŠ¹ì„± ë¶„ì„ + ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜ í†µí•© ì‹œìŠ¤í…œ (Revised)
%          (Logistic Regression ê¸°ë°˜ í™•ë¥  ì¡°ì • ë°©ì‹)
% =========================================================================
% ëª©ì : 1) ì†Œí™”ì„± ì¸ì¬ì˜ ì—­ëŸ‰ í”„ë¡œíŒŒì¼ ë¶„ì„
%       2) Logistic Regressionìœ¼ë¡œ ì†Œí™”ì„± í™•ë¥  ê³„ì‚°
%       3) ê¸°ì¡´ ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜ ì ìˆ˜ì— í™•ë¥  ê¸°ë°˜ ì¡°ì • ì ìš©
%       4) Excel ì ìš© ê°€ëŠ¥í•œ ê³„ìˆ˜ í…Œì´ë¸” ì¶œë ¥
% =========================================================================
% ê°œì„ ì‚¬í•­:
%   - ê¸°ì¡´ ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜ íŒŒì¼ ì—°ë™
%   - Logistic í™•ë¥  ê¸°ë°˜ ì ìˆ˜ ì¡°ì • ë¡œì§ ì¶”ê°€
%   - Excel ìˆ˜ì‹ ì¬í˜„ì„ ìœ„í•œ ê³„ìˆ˜ í…Œì´ë¸” ìƒì„±
%   - ì‹¤ì œ ì ìš© ì˜ˆì‹œ ë° ê²€ì¦ ì‹œíŠ¸ ì¶”ê°€
% =========================================================================


clear; clc; close all;
rng(42, 'twister');

%% ========================================================================
%                          PART 1: ê¸°ë³¸ ì„¤ì • ë° ë°ì´í„° ë¡œë”©
% =========================================================================

fprintf('\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n');
fprintf('â•‘      ì†Œí™”ì„± ì¸ì¬ íŠ¹ì„± ë¶„ì„ + ê°€ì¤‘ì¹˜ í†µí•© ì‹œìŠ¤í…œ          â•‘\n');
fprintf('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n');

%% 1.1 ì„¤ì •
config = struct();
config.hr_file = 'D:\project\HRë°ì´í„°\ë°ì´í„°\ì—­ëŸ‰ê²€ì‚¬ ìš”ì²­ ì •ë³´\ìµœê·¼ 3ë…„ ì…ì‚¬ì_ì¸ì ì •ë³´_revised.xlsx';
config.comp_file = 'D:\project\HRë°ì´í„°\ë°ì´í„°\ì—­ëŸ‰ê²€ì‚¬ ìš”ì²­ ì •ë³´\23-25ë…„ ì—­ëŸ‰ê²€ì‚¬_ê°œë°œìì¶”ê°€.xlsx';
config.output_dir = 'D:\project\HRë°ì´í„°\ê²°ê³¼\ì†Œí™”ì„±ë¶„ì„_talent';  % talent ë¶„ì„ê³¼ ì¼ê´€ì„±
config.timestamp = datestr(now, 'yyyy-mm-dd_HHMMSS');

% integrated_analysis_results.mat íŒŒì¼ ìš°ì„  ì‚¬ìš©
config.integrated_model_dir = 'D:\project\HRë°ì´í„°\ê²°ê³¼\ìê°€ë¶ˆì†Œ_revised_talent';
config.integrated_model_file = fullfile(config.integrated_model_dir, 'integrated_analysis_results.mat');

% ë°±ì—…: ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜ íŒŒì¼ (ì—‘ì…€)
weight_files = dir('D:\project\HRë°ì´í„°\ê²°ê³¼\ìê°€ë¶ˆì†Œ_revised_talent\ì—­ëŸ‰ê²€ì‚¬_ê°€ì¤‘ì¹˜ì ìš©ì ìˆ˜_talent_*.xlsx');
if ~isempty(weight_files)
    [~, latest_idx] = max([weight_files.datenum]);
    config.weight_file = fullfile(weight_files(latest_idx).folder, weight_files(latest_idx).name);
    fprintf('ğŸ“ ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜ íŒŒì¼ (ë°±ì—…): %s\n', weight_files(latest_idx).name);
else
    config.weight_file = '';
end

% ì¶œë ¥ í´ë” ìƒì„±
if ~exist(config.output_dir, 'dir')
    mkdir(config.output_dir);
end

% í•œê¸€ í°íŠ¸ ì„¤ì •
set(0, 'DefaultAxesFontName', 'Malgun Gothic');
set(0, 'DefaultTextFontName', 'Malgun Gothic');

%% 1.2 ê¸°ì¡´ ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜ ë¡œë“œ
fprintf('\nã€STEP 1ã€‘ ê¸°ì¡´ ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜ ë¡œë“œ\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

base_weights_table = table();

% ìš°ì„  1: integrated_analysis_results.mat ì‚¬ìš©
if exist(config.integrated_model_file, 'file')
    try
        fprintf('  â†’ integrated_analysis_results.mat ë¡œë“œ ì‹œë„...\n');
        loaded_data = load(config.integrated_model_file);

        if isfield(loaded_data, 'integrated_results')
            integrated_results = loaded_data.integrated_results;

            % final_composite_weights ì‚¬ìš©
            if isfield(integrated_results, 'final_composite_weights') && ...
               isfield(integrated_results, 'feature_names')

                base_weights_table = table();
                base_weights_table.('ì—­ëŸ‰ëª…') = string(integrated_results.feature_names(:));
                base_weights_table.('ê°€ì¤‘ì¹˜_í¼ì„¼íŠ¸') = integrated_results.final_composite_weights(:);

                fprintf('  âœ“ integrated_results ë¡œë“œ ì„±ê³µ: %dê°œ ì—­ëŸ‰\n', height(base_weights_table));
                fprintf('    (final_composite_weights ì‚¬ìš©)\n');
            end
        end
    catch ME
        warning('integrated_results ë¡œë“œ ì‹¤íŒ¨: %s', ME.message);
    end
end

% ë°±ì—… 2: Excel ê°€ì¤‘ì¹˜ íŒŒì¼ ì‚¬ìš©
if isempty(base_weights_table) && ~isempty(config.weight_file) && exist(config.weight_file, 'file')
    try
        fprintf('  â†’ Excel ê°€ì¤‘ì¹˜ íŒŒì¼ ë¡œë“œ ì‹œë„...\n');
        weight_info = readtable(config.weight_file, 'Sheet', 'ê°€ì¤‘ì¹˜_ìƒì„¸ì •ë³´', 'VariableNamingRule', 'preserve');
        base_weights_table = weight_info(:, 1:2);
        base_weights_table.Properties.VariableNames = {'ì—­ëŸ‰ëª…', 'ê°€ì¤‘ì¹˜_í¼ì„¼íŠ¸'};

        fprintf('  âœ“ Excel ê°€ì¤‘ì¹˜ ë¡œë“œ ì„±ê³µ: %dê°œ ì—­ëŸ‰\n', height(base_weights_table));
    catch ME
        warning('Excel ê°€ì¤‘ì¹˜ íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: %s', ME.message);
    end
end

if isempty(base_weights_table)
    fprintf('  âš  ê°€ì¤‘ì¹˜ íŒŒì¼ ì—†ìŒ, ë¶„ì„ë§Œ ì§„í–‰\n');
else
    disp(base_weights_table);
end

%% 1.3 ë°ì´í„° ë¡œë”©
fprintf('\nã€STEP 2ã€‘ HR ë° ì—­ëŸ‰ ë°ì´í„° ë¡œë”©\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

hr_data = readtable(config.hr_file, 'VariableNamingRule', 'preserve');
comp_upper = readtable(config.comp_file, 'Sheet', 'ì—­ëŸ‰ê²€ì‚¬_ìƒìœ„í•­ëª©', 'VariableNamingRule', 'preserve');

fprintf('  âœ“ HR ë°ì´í„°: %dëª…\n', height(hr_data));
fprintf('  âœ“ ì—­ëŸ‰ ë°ì´í„°: %dëª…\n', height(comp_upper));

%% 1.4 ì‹ ë¢°ê°€ëŠ¥ì„± í•„í„°ë§
reliability_col = find(contains(comp_upper.Properties.VariableNames, 'ì‹ ë¢°ê°€ëŠ¥ì„±'), 1);
if ~isempty(reliability_col)
    unreliable = strcmp(comp_upper{:, reliability_col}, 'ì‹ ë¢°ë¶ˆê°€');
    comp_upper = comp_upper(~unreliable, :);
    fprintf('  ì‹ ë¢°ë¶ˆê°€ ì œì™¸: %dëª… â†’ %dëª…\n', sum(unreliable), height(comp_upper));
end

%% 1.5 ì—­ëŸ‰ ì»¬ëŸ¼ ì¶”ì¶œ
fprintf('\nã€STEP 3ã€‘ ì—­ëŸ‰ ë°ì´í„° ì¶”ì¶œ\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

valid_comp_cols = {};
valid_comp_indices = [];

for i = 6:width(comp_upper)
    col_name = comp_upper.Properties.VariableNames{i};
    col_data = comp_upper{:, i};

    if isnumeric(col_data) && ~all(isnan(col_data))
        valid_data = col_data(~isnan(col_data));
        if length(valid_data) >= 5 && var(valid_data) > 0
            valid_comp_cols{end+1} = col_name;
            valid_comp_indices(end+1) = i;
        end
    end
end

fprintf('  âœ“ ìœ íš¨ ì—­ëŸ‰: %dê°œ\n', length(valid_comp_cols));

%% 1.6 ì¸ì¬ìœ í˜• ë§¤ì¹­
fprintf('\nã€STEP 4ã€‘ ì¸ì¬ìœ í˜• ë§¤ì¹­\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

talent_col = find(contains(hr_data.Properties.VariableNames, 'ì¸ì¬ìœ í˜•'), 1);
hr_clean = hr_data(~cellfun(@isempty, hr_data{:, talent_col}), :);

% ìœ„ì¥í˜• ì†Œí™”ì„± ì œì™¸
excluded = strcmp(hr_clean{:, talent_col}, 'ìœ„ì¥í˜• ì†Œí™”ì„±');
hr_clean = hr_clean(~excluded, :);

% ID ë§¤ì¹­
hr_ids = arrayfun(@(x) sprintf('%.0f', x), hr_clean.ID, 'UniformOutput', false);
comp_ids = arrayfun(@(x) sprintf('%.0f', x), comp_upper{:, 1}, 'UniformOutput', false);

[matched_ids, hr_idx, comp_idx] = intersect(hr_ids, comp_ids);

matched_hr = hr_clean(hr_idx, :);
matched_comp = comp_upper(comp_idx, valid_comp_indices);
matched_types = matched_hr{:, talent_col};

fprintf('  âœ“ ë§¤ì¹­ ì„±ê³µ: %dëª…\n', length(matched_ids));

%% 1.7 ê²°ì¸¡ì¹˜ ì²˜ë¦¬ (2ë‹¨ê³„ í•„í„°ë§ - analysis íŒŒì¼ê³¼ ë™ì¼)
fprintf('\nã€STEP 4.5ã€‘ ê²°ì¸¡ì¹˜ ì²˜ë¦¬ (2ë‹¨ê³„)\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

X_raw = table2array(matched_comp);

% Step 1: ê²°ì¸¡ë¥  30% ì´ìƒ ì œê±°
missing_rate_per_sample = sum(isnan(X_raw), 2) / size(X_raw, 2);
quality_threshold = 0.3;
quality_samples = missing_rate_per_sample < quality_threshold;

fprintf('  Step 1 - ê³ í’ˆì§ˆ ìƒ˜í”Œ ì„ íƒ:\n');
fprintf('    â€¢ ê²°ì¸¡ë¥  30%% ì´ìƒ ì œê±°: %dëª…\n', sum(~quality_samples));
fprintf('    â€¢ ë‚¨ì€ ìƒ˜í”Œ: %dëª…\n', sum(quality_samples));

X_quality = X_raw(quality_samples, :);
types_quality = matched_types(quality_samples);
ids_quality = matched_ids(quality_samples);

% Step 2: ì™„ì „í•œ ì¼€ì´ìŠ¤ë§Œ ì‚¬ìš©
complete_cases = ~any(isnan(X_quality), 2);

X_clean = X_quality(complete_cases, :);
types_clean = types_quality(complete_cases);
ids_clean = ids_quality(complete_cases);

fprintf('\n  Step 2 - ì™„ì „í•œ ì¼€ì´ìŠ¤ë§Œ ì‚¬ìš©:\n');
fprintf('    â€¢ ì¶”ê°€ ì œê±°: %dëª…\n', sum(~complete_cases));
fprintf('    â€¢ ìµœì¢… ìƒ˜í”Œ: %dëª…\n', size(X_clean, 1));
fprintf('\n  âœ“ 2ë‹¨ê³„ í•„í„°ë§ ì™„ë£Œ: %dëª… â†’ %dëª…\n', size(X_raw, 1), size(X_clean, 1));

%% ========================================================================
%                    PART 2: ì†Œí™”ì„± vs ë‚˜ë¨¸ì§€ ê·¸ë£¹ ë¶„ì„
% =========================================================================

fprintf('\n\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n');
fprintf('â•‘              PART 2: ì†Œí™”ì„± vs ë‚˜ë¨¸ì§€ ë¹„êµ ë¶„ì„          â•‘\n');
fprintf('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n');

%% 2.1 ê·¸ë£¹ ë¶„ë¦¬
fprintf('ã€STEP 5ã€‘ ì†Œí™”ì„± vs ë‚˜ë¨¸ì§€ ê·¸ë£¹ ë¶„ë¦¬\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

sohwa_idx = strcmp(types_clean, 'ì†Œí™”ì„±');
normal_idx = ~sohwa_idx;

X_sohwa = X_clean(sohwa_idx, :);
X_normal = X_clean(normal_idx, :);

n_sohwa = sum(sohwa_idx);
n_normal = sum(normal_idx);

fprintf('  ì†Œí™”ì„±: %dëª… (%.1f%%)\n', n_sohwa, n_sohwa/(n_sohwa+n_normal)*100);
fprintf('  ë‚˜ë¨¸ì§€: %dëª… (%.1f%%)\n', n_normal, n_normal/(n_sohwa+n_normal)*100);

% ì¸ì¬ìœ í˜•ë³„ ë¶„í¬
unique_types = unique(types_clean);
fprintf('\n  ì¸ì¬ìœ í˜• ë¶„í¬:\n');
for i = 1:length(unique_types)
    count = sum(strcmp(types_clean, unique_types{i}));
    fprintf('    - %s: %dëª…\n', unique_types{i}, count);
end

%% 2.2 ì—­ëŸ‰ë³„ t-test ë¹„êµ
fprintf('\nã€STEP 6ã€‘ ì—­ëŸ‰ë³„ t-test ë¶„ì„\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

ttest_results = table();
ttest_results.Competency = valid_comp_cols';
ttest_results.Sohwa_Mean = nanmean(X_sohwa, 1)';
ttest_results.Sohwa_Std = nanstd(X_sohwa, 0, 1)';
ttest_results.Normal_Mean = nanmean(X_normal, 1)';
ttest_results.Normal_Std = nanstd(X_normal, 0, 1)';
ttest_results.Mean_Diff = ttest_results.Sohwa_Mean - ttest_results.Normal_Mean;

n_comps = length(valid_comp_cols);
ttest_results.t_stat = zeros(n_comps, 1);
ttest_results.p_value = zeros(n_comps, 1);
ttest_results.Cohen_d = zeros(n_comps, 1);
ttest_results.Significance = cell(n_comps, 1);

for i = 1:n_comps
    sohwa_scores = X_sohwa(:, i);
    normal_scores = X_normal(:, i);

    [h, p, ~, stats] = ttest2(sohwa_scores, normal_scores);
    ttest_results.t_stat(i) = stats.tstat;
    ttest_results.p_value(i) = p;

    pooled_std = sqrt(((length(sohwa_scores)-1)*var(sohwa_scores) + ...
                      (length(normal_scores)-1)*var(normal_scores)) / ...
                      (length(sohwa_scores) + length(normal_scores) - 2));
    ttest_results.Cohen_d(i) = ttest_results.Mean_Diff(i) / pooled_std;

    if p < 0.001
        ttest_results.Significance{i} = '***';
    elseif p < 0.01
        ttest_results.Significance{i} = '**';
    elseif p < 0.05
        ttest_results.Significance{i} = '*';
    else
        ttest_results.Significance{i} = '';
    end
end

ttest_results = sortrows(ttest_results, 'Cohen_d', 'ascend');

fprintf('\nì†Œí™”ì„± íŠ¹ì§• ì—­ëŸ‰ (Cohen''s d < -0.5 & p < 0.05):\n');
fprintf('%-25s | ì†Œí™”ì„± | ë‚˜ë¨¸ì§€ | ì°¨ì´ | Cohen''s d | p-value\n', 'ì—­ëŸ‰');
fprintf('%s\n', repmat('-', 80, 1));

significant_idx = ttest_results.Cohen_d < -0.5 & ttest_results.p_value < 0.05;

for i = 1:sum(significant_idx)
    row = ttest_results(i, :);
    fprintf('%-25s | %6.1f | %6.1f | %+5.1f | %+7.3f | %.4f%s\n', ...
        row.Competency{1}, ...
        row.Sohwa_Mean, row.Normal_Mean, row.Mean_Diff, ...
        row.Cohen_d, row.p_value, row.Significance{1});
end

%% ========================================================================
%                    PART 3: Logistic Regression ëª¨ë¸ í•™ìŠµ
% =========================================================================

fprintf('\n\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n');
fprintf('â•‘       PART 3: Logistic Regression ì†Œí™”ì„± íŒë³„ ëª¨ë¸       â•‘\n');
fprintf('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n');

%% 3.1 Leave-One-Out êµì°¨ê²€ì¦ìœ¼ë¡œ ìµœì  Lambda ì°¾ê¸°
fprintf('ã€STEP 7ã€‘ Leave-One-Out êµì°¨ê²€ì¦ìœ¼ë¡œ ìµœì  Lambda ì°¾ê¸°\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

% ë ˆì´ë¸” ìƒì„±
y_binary = double(sohwa_idx);

% Lambda íŒŒë¼ë¯¸í„° ë²”ìœ„ ì„¤ì •
lambda_range = logspace(-3, 0, 10);  % 0.001 ~ 1.0
fprintf('Lambda í›„ë³´ê°’: [%.4f ~ %.4f], %dê°œ ì§€ì \n', min(lambda_range), max(lambda_range), length(lambda_range));
fprintf('  í‘œì¤€í™”ëŠ” êµì°¨ê²€ì¦ ë‚´ë¶€ì—ì„œ ìˆ˜í–‰ë©ë‹ˆë‹¤ (ë°ì´í„° ëˆ„ìˆ˜ ë°©ì§€)\n\n');

% Leave-One-Out êµì°¨ê²€ì¦ ìˆ˜í–‰
cv_scores = zeros(length(lambda_range), 1);
cv_aucs = zeros(length(lambda_range), 1);

fprintf('LOO-CV ì§„í–‰ìƒí™©:\n');
for lambda_idx = 1:length(lambda_range)
    current_lambda = lambda_range(lambda_idx);

    % LOO-CVë¥¼ ìœ„í•œ ì˜ˆì¸¡ê°’ ì €ì¥
    loo_predictions = zeros(length(y_binary), 1);
    loo_probabilities = zeros(length(y_binary), 1);

    % Leave-One-Out ë£¨í”„
    for i = 1:length(y_binary)
        % í›ˆë ¨ ë°ì´í„° (ië²ˆì§¸ ìƒ˜í”Œ ì œì™¸)
        train_idx = true(length(y_binary), 1);
        train_idx(i) = false;

        X_train = X_clean(train_idx, :);  % ì›ë³¸ ë°ì´í„° ì‚¬ìš©
        y_train = y_binary(train_idx);
        X_test = X_clean(i, :);  % ì›ë³¸ ë°ì´í„° ì‚¬ìš©

        % â˜… í›ˆë ¨ ì„¸íŠ¸ë¡œë§Œ í‘œì¤€í™” (ë°ì´í„° ëˆ„ìˆ˜ ë°©ì§€)
        mu = mean(X_train, 1);
        sigma = std(X_train, 0, 1);
        sigma(sigma == 0) = 1;  % 0 ë°©ì§€

        X_train_z = (X_train - mu) ./ sigma;
        X_test_z = (X_test - mu) ./ sigma;

        % í´ë˜ìŠ¤ ê°€ì¤‘ì¹˜ ê³„ì‚°
        w = zeros(size(y_train));
        n_class0 = sum(y_train == 0);
        n_class1 = sum(y_train == 1);

        % ì—­ë¹ˆë„ ê°€ì¤‘ì¹˜
        w(y_train == 0) = length(y_train) / (2 * n_class0);
        w(y_train == 1) = length(y_train) / (2 * n_class1);

        try
            mdl = fitclinear(X_train_z, y_train, ...
                'Learner', 'logistic', ...
                'Regularization', 'ridge', ...
                'Lambda', current_lambda, ...
                'Solver', 'lbfgs', ...
                'Weights', w);

            [pred_label, pred_score] = predict(mdl, X_test_z);
            loo_predictions(i) = pred_label;
            loo_probabilities(i) = pred_score(2);
        catch
            % í´ë°±
            loo_predictions(i) = mode(y_train);
            loo_probabilities(i) = mean(y_train);
        end
    end

    % ì„±ëŠ¥ í‰ê°€
    accuracy_cv = mean(loo_predictions == y_binary);

    % AUC ê³„ì‚°
    try
        [~, ~, ~, auc] = perfcurve(y_binary, loo_probabilities, 1);
        cv_aucs(lambda_idx) = auc;
    catch
        cv_aucs(lambda_idx) = 0.5;  % ê¸°ë³¸ê°’
    end

    cv_scores(lambda_idx) = accuracy_cv;

    fprintf('  Î»=%.4f: ì •í™•ë„=%.3f, AUC=%.3f\n', current_lambda, accuracy_cv, cv_aucs(lambda_idx));
end

% ìµœì  Lambda ì„ íƒ (AUC ê¸°ì¤€)
[best_auc, best_idx] = max(cv_aucs);
optimal_lambda = lambda_range(best_idx);

fprintf('\nìµœì  Lambda ì„ íƒ:\n');
fprintf('  ìµœì  Î»: %.4f\n', optimal_lambda);
fprintf('  ìµœê³  AUC: %.3f\n', best_auc);
fprintf('  í•´ë‹¹ ì •í™•ë„: %.3f\n', cv_scores(best_idx));

%% 3.2 ìµœì  Lambdaë¡œ ìµœì¢… ëª¨ë¸ í•™ìŠµ
fprintf('\nã€STEP 8ã€‘ ìµœì¢… Logistic Regression ëª¨ë¸ í•™ìŠµ\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

% ì „ì²´ ë°ì´í„°ë¡œ í‘œì¤€í™” (ìµœì¢… ëª¨ë¸ìš©)
mu_comp = mean(X_clean, 1);
sigma_comp = std(X_clean, 0, 1);
sigma_comp(sigma_comp == 0) = 1;
X_all_z = (X_clean - mu_comp) ./ sigma_comp;

% í´ë˜ìŠ¤ ê°€ì¤‘ì¹˜
class_weights = [sum(y_binary==1)/length(y_binary), ...
                 sum(y_binary==0)/length(y_binary)];
sample_weights = zeros(size(y_binary));
sample_weights(y_binary == 1) = 1 / class_weights(1);
sample_weights(y_binary == 0) = 1 / class_weights(2);

% ë¡œì§€ìŠ¤í‹± íšŒê·€ í•™ìŠµ
try
    logit_model = fitclinear(X_all_z, y_binary, ...
        'Learner', 'logistic', ...
        'Regularization', 'ridge', ...
        'Lambda', optimal_lambda, ...
        'Solver', 'lbfgs', ...
        'Weights', sample_weights);

    fprintf('  âœ“ ë¡œì§€ìŠ¤í‹± íšŒê·€ í•™ìŠµ ì™„ë£Œ\n');

    % ê³„ìˆ˜ ì¶”ì¶œ
    beta_coefficients = logit_model.Beta;
    beta_bias = logit_model.Bias;

    % ì„±ëŠ¥ í‰ê°€
    [pred_labels, pred_scores] = predict(logit_model, X_all_z);

    % í™•ë¥  ê³„ì‚° (Sigmoid)
    logits = X_all_z * beta_coefficients + beta_bias;
    sohwa_probabilities = 1 ./ (1 + exp(-logits));

    % ROC ë¶„ì„
    [X_roc, Y_roc, T_roc, AUC] = perfcurve(y_binary, sohwa_probabilities, 1);

    % ìµœì  ì„ê³„ê°’ ì°¾ê¸° (Youden's J statistic)
    J = Y_roc - X_roc;
    [~, opt_idx] = max(J);
    optimal_threshold = T_roc(opt_idx);

    % í˜¼ë™ í–‰ë ¬
    TP = sum(pred_labels == 1 & y_binary == 1);
    TN = sum(pred_labels == 0 & y_binary == 0);
    FP = sum(pred_labels == 1 & y_binary == 0);
    FN = sum(pred_labels == 0 & y_binary == 1);

    accuracy = (TP + TN) / length(y_binary);
    precision = TP / (TP + FP);
    recall = TP / (TP + FN);
    f1 = 2 * (precision * recall) / (precision + recall);

    fprintf('  ì ˆí¸: %.4f\n', beta_bias);
    fprintf('  ì •í™•ë„: %.3f | ì •ë°€ë„: %.3f | ì¬í˜„ìœ¨: %.3f | F1: %.3f\n', ...
        accuracy, precision, recall, f1);
    fprintf('  AUC: %.3f\n', AUC);
    fprintf('  ìµœì  ì„ê³„ê°’: %.3f (ë¯¼ê°ë„=%.3f, íŠ¹ì´ë„=%.3f)\n', ...
        optimal_threshold, Y_roc(opt_idx), 1-X_roc(opt_idx));

    logit_success = true;
catch ME
    fprintf('  âš  ë¡œì§€ìŠ¤í‹± íšŒê·€ ì‹¤íŒ¨: %s\n', ME.message);
    logit_success = false;
    beta_coefficients = [];
    beta_bias = 0;
    sohwa_probabilities = zeros(size(y_binary));
    AUC = 0.5;
    optimal_threshold = 0.5;
    X_roc = []; Y_roc = []; opt_idx = 1;
end

%% ========================================================================
%                PART 4: ê¸°ì¡´ ê°€ì¤‘ì¹˜ ì ìˆ˜ + ì†Œí™”ì„± í™•ë¥  ì¡°ì •
% =========================================================================

fprintf('\n\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n');
fprintf('â•‘        PART 4: ê¸°ì¡´ ê°€ì¤‘ì¹˜ ì ìˆ˜ + ì†Œí™”ì„± í™•ë¥  ì¡°ì •       â•‘\n');
fprintf('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n');

%% 4.1 ê¸°ì¡´ ê°€ì¤‘ì¹˜ ì ìˆ˜ ê³„ì‚°
fprintf('ã€STEP 9ã€‘ ê¸°ì¡´ ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜ ì ìˆ˜ ê³„ì‚°\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

if ~isempty(base_weights_table)
    % ì—­ëŸ‰ëª… ë§¤ì¹­
    base_scores = zeros(size(X_clean, 1), 1);
    matched_weights = zeros(1, n_comps);

    for i = 1:n_comps
        comp_name = valid_comp_cols{i};
        weight_idx = find(strcmp(base_weights_table.('ì—­ëŸ‰ëª…'), comp_name), 1);

        if ~isempty(weight_idx)
            matched_weights(i) = base_weights_table.('ê°€ì¤‘ì¹˜_í¼ì„¼íŠ¸')(weight_idx);
        end
    end

    % Z-scoreë¡œ ì •ê·œí™” í›„ ê°€ì¤‘ì¹˜ ì ìš©
    X_clean_z = zscore(X_clean);
    X_clean_z(isnan(X_clean_z)) = 0;

    weighted_scores = X_clean_z * (matched_weights' / 100);

    % 0-100 ë²”ìœ„ë¡œ ë³€í™˜
    min_score = min(weighted_scores);
    max_score = max(weighted_scores);
    base_scores = 100 * (weighted_scores - min_score) / (max_score - min_score);

    fprintf('  âœ“ ê¸°ì¡´ ê°€ì¤‘ì¹˜ ì ìˆ˜ ê³„ì‚° ì™„ë£Œ\n');
    fprintf('    - í‰ê· : %.2f Â± %.2f\n', mean(base_scores), std(base_scores));
    fprintf('    - ë²”ìœ„: [%.2f, %.2f]\n', min(base_scores), max(base_scores));
else
    fprintf('  âš  ê°€ì¤‘ì¹˜ ì •ë³´ ì—†ìŒ, ê· ë“± ê°€ì¤‘ì¹˜ ì‚¬ìš©\n');
    base_scores = mean(X_clean, 2);
end

%% 4.2 ì†Œí™”ì„± í™•ë¥  ê¸°ë°˜ ì ìˆ˜ ì¡°ì •
fprintf('\nã€STEP 10ã€‘ ì†Œí™”ì„± í™•ë¥  ê¸°ë°˜ ì ìˆ˜ ì¡°ì •\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

if logit_success
    % ì¡°ì • ê°•ë„ íŒŒë¼ë¯¸í„° (HRì´ ì¡°ì • ê°€ëŠ¥)
    adjustment_strength = 0.5;  % 0~1 ì‚¬ì´ (ê¸°ë³¸ê°’ 0.5)

    % ì¡°ì • ì ìˆ˜ ê³„ì‚°
    adjusted_scores = base_scores .* (1 - sohwa_probabilities * adjustment_strength);

    fprintf('  âœ“ ì¡°ì • ê°•ë„: %.2f\n', adjustment_strength);
    fprintf('  âœ“ ì¡°ì • ì ìˆ˜ ê³„ì‚° ì™„ë£Œ\n');
    fprintf('    - ì¡°ì • ì „ í‰ê· : %.2f Â± %.2f\n', mean(base_scores), std(base_scores));
    fprintf('    - ì¡°ì • í›„ í‰ê· : %.2f Â± %.2f\n', mean(adjusted_scores), std(adjusted_scores));

    % ì†Œí™”ì„± ê·¸ë£¹ì˜ ì ìˆ˜ ë³€í™”
    sohwa_base_mean = mean(base_scores(sohwa_idx));
    sohwa_adjusted_mean = mean(adjusted_scores(sohwa_idx));
    normal_base_mean = mean(base_scores(normal_idx));
    normal_adjusted_mean = mean(adjusted_scores(normal_idx));

    fprintf('\n  ê·¸ë£¹ë³„ ì ìˆ˜ ë³€í™”:\n');
    fprintf('    ì†Œí™”ì„±: %.2f â†’ %.2f (%.2fì  ê°ì†Œ)\n', ...
        sohwa_base_mean, sohwa_adjusted_mean, sohwa_base_mean - sohwa_adjusted_mean);
    fprintf('    ë‚˜ë¨¸ì§€: %.2f â†’ %.2f (%.2fì  ê°ì†Œ)\n', ...
        normal_base_mean, normal_adjusted_mean, normal_base_mean - normal_adjusted_mean);
else
    adjusted_scores = base_scores;
    fprintf('  âš  Logistic ëª¨ë¸ ì—†ìŒ, ì¡°ì • ì—†ì´ ê¸°ì¡´ ì ìˆ˜ ì‚¬ìš©\n');
end

%% ========================================================================
%                          PART 5: Excel ì¶œë ¥ìš© í…Œì´ë¸” ìƒì„±
% =========================================================================

fprintf('\n\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n');
fprintf('â•‘            PART 5: Excel ì¶œë ¥ìš© í…Œì´ë¸” ìƒì„±               â•‘\n');
fprintf('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n');

%% 5.1 Logistic ê³„ìˆ˜ í…Œì´ë¸” (Excel ìˆ˜ì‹ìš©)
fprintf('ã€STEP 11ã€‘ Logistic ê³„ìˆ˜ í…Œì´ë¸” ìƒì„±\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

if logit_success
    logit_coef_table = table();
    logit_coef_table.('ì—­ëŸ‰ëª…') = ['ì ˆí¸(Bias)'; valid_comp_cols'];
    logit_coef_table.('Logisticê³„ìˆ˜') = [beta_bias; beta_coefficients];
    logit_coef_table.('ì„¤ëª…') = [{'ëª¨ë¸ ì ˆí¸'}; repmat({'ì—­ëŸ‰ë³„ ê³„ìˆ˜'}, n_comps, 1)];

    % Z-score ë³€í™˜ íŒŒë¼ë¯¸í„° ì¶”ê°€
    zscore_params = table();
    zscore_params.('ì—­ëŸ‰ëª…') = valid_comp_cols';
    zscore_params.('í‰ê· ') = mu_comp';
    zscore_params.('í‘œì¤€í¸ì°¨') = sigma_comp';

    fprintf('  âœ“ Logistic ê³„ìˆ˜ í…Œì´ë¸” ìƒì„± ì™„ë£Œ\n');
    fprintf('    - ì ˆí¸: %.4f\n', beta_bias);
    fprintf('    - ê³„ìˆ˜ ë²”ìœ„: [%.4f, %.4f]\n', min(beta_coefficients), max(beta_coefficients));
else
    logit_coef_table = table();
    zscore_params = table();
    fprintf('  âš  Logistic ëª¨ë¸ ì—†ìŒ, ê³„ìˆ˜ í…Œì´ë¸” ìƒì„± ë¶ˆê°€\n');
end

%% 5.2 ê°œë³„ ê²°ê³¼ í…Œì´ë¸”
fprintf('\nã€STEP 12ã€‘ ê°œë³„ ê²°ê³¼ í…Œì´ë¸” ìƒì„±\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

individual_results = table();
individual_results.('ID') = ids_clean;
individual_results.('ì¸ì¬ìœ í˜•') = types_clean;
individual_results.('ì†Œí™”ì„±ì—¬ë¶€') = y_binary;

% ì—­ëŸ‰ ì ìˆ˜ ì¶”ê°€
for i = 1:n_comps
    individual_results.(valid_comp_cols{i}) = X_clean(:, i);
end

individual_results.('ê¸°ì¡´ê°€ì¤‘ì¹˜ì ìˆ˜') = base_scores;

if logit_success
    individual_results.('ì†Œí™”ì„±í™•ë¥ ') = sohwa_probabilities;
    individual_results.('ì¡°ì •í›„ì ìˆ˜') = adjusted_scores;
    individual_results.('ì ìˆ˜ë³€í™”') = base_scores - adjusted_scores;
end

fprintf('  âœ“ ê°œë³„ ê²°ê³¼ í…Œì´ë¸” ìƒì„± ì™„ë£Œ: %dëª…\n', height(individual_results));

%% 5.3 ì ìš© ê°€ì´ë“œ í…Œì´ë¸”
fprintf('\nã€STEP 13ã€‘ Excel ì ìš© ê°€ì´ë“œ ìƒì„±\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

application_guide = table();
application_guide.('ë‹¨ê³„') = {'1ë‹¨ê³„'; '2ë‹¨ê³„'; '3ë‹¨ê³„'; '4ë‹¨ê³„'; '5ë‹¨ê³„'};
application_guide.('ì‘ì—…ë‚´ìš©') = {
    'ì—­ëŸ‰ ì ìˆ˜ë¥¼ Z-scoreë¡œ ë³€í™˜: (ì ìˆ˜ - í‰ê· ) / í‘œì¤€í¸ì°¨';
    'Logistic ê³„ì‚°: ì ˆí¸ + Î£(Z-score Ã— ê³„ìˆ˜)';
    'ì†Œí™”ì„± í™•ë¥  ê³„ì‚°: 1 / (1 + EXP(-Logisticê°’))';
    'ê¸°ì¡´ ê°€ì¤‘ì¹˜ ì ìˆ˜ ê³„ì‚°';
    'ì¡°ì • ì ìˆ˜ = ê¸°ì¡´ì ìˆ˜ Ã— (1 - ì†Œí™”ì„±í™•ë¥  Ã— ì¡°ì •ê°•ë„)'
};
application_guide.('Excelìˆ˜ì‹ì˜ˆì‹œ') = {
    '=(B2 - VLOOKUP("ì „ëµì„±", ì •ê·œí™”íŒŒë¼ë¯¸í„°!A:B, 2)) / VLOOKUP("ì „ëµì„±", ì •ê·œí™”íŒŒë¼ë¯¸í„°!A:C, 3)';
    '=VLOOKUP("ì ˆí¸", Logisticê³„ìˆ˜!A:B, 2) + SUMPRODUCT(Zì ìˆ˜ë²”ìœ„, VLOOKUP(ì—­ëŸ‰ëª…ë²”ìœ„, Logisticê³„ìˆ˜!A:B, 2))';
    '=1 / (1 + EXP(-D2))';
    '=SUMPRODUCT(ì—­ëŸ‰ì ìˆ˜ë²”ìœ„, ê°€ì¤‘ì¹˜ë²”ìœ„)';
    '=F2 * (1 - E2 * 0.5)'
};

fprintf('  âœ“ ì ìš© ê°€ì´ë“œ ìƒì„± ì™„ë£Œ\n');

%% ========================================================================
%                          PART 6: ì‹œê°í™”
% =========================================================================

fprintf('\n\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n');
fprintf('â•‘                    PART 6: ì‹œê°í™”                         â•‘\n');
fprintf('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n');

fprintf('ã€STEP 14ã€‘ ì¢…í•© ê²°ê³¼ ì‹œê°í™”\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

fig = figure('Position', [100, 100, 1600, 1200], 'Color', 'white');

% [1] Lambda ìµœì í™” ê³¼ì • (LOO-CV)
if logit_success
    subplot(1, 3, 1);
    yyaxis left
    plot(lambda_range, cv_scores, 'o-', 'LineWidth', 2, 'Color', [0.2, 0.4, 0.8]);
    ylabel('ì •í™•ë„', 'Color', [0.2, 0.4, 0.8]);
    ylim([min(cv_scores)-0.02, max(cv_scores)+0.02]);

    yyaxis right
    plot(lambda_range, cv_aucs, 's-', 'LineWidth', 2, 'Color', [0.8, 0.3, 0.2]);
    ylabel('AUC', 'Color', [0.8, 0.3, 0.2]);
    ylim([min(cv_aucs)-0.02, max(cv_aucs)+0.02]);

    % ìµœì ì  í‘œì‹œ
    hold on;
    yyaxis right;
    plot(optimal_lambda, best_auc, 'r*', 'MarkerSize', 12, 'LineWidth', 3);

    set(gca, 'XScale', 'log');
    xlabel('Lambda (ì •ê·œí™” ê°•ë„)');
    title('LOO-CV Lambda ìµœì í™”');
    grid on;
else
    subplot(1, 3, 1);
    text(0.5, 0.5, 'ëª¨ë¸ í•™ìŠµ ì‹¤íŒ¨', 'HorizontalAlignment', 'center');
    axis off;
end

% [2] ROC ê³¡ì„ 
if logit_success
    subplot(1, 3, 2);
    plot(X_roc, Y_roc, 'LineWidth', 3, 'Color', [0.2, 0.4, 0.8]);
    hold on;
    plot([0, 1], [0, 1], '--', 'Color', [0.5, 0.5, 0.5], 'LineWidth', 1.5);

    % ìµœì ì  í‘œì‹œ
    plot(X_roc(opt_idx), Y_roc(opt_idx), 'ro', 'MarkerSize', 10, 'LineWidth', 2);

    xlabel('ìœ„ì–‘ì„±ë¥  (1-íŠ¹ì´ë„)');
    ylabel('ë¯¼ê°ë„');
    title(sprintf('ROC ê³¡ì„  (AUC=%.3f)', AUC));
    legend({'ROC ê³¡ì„ ', 'ë¬´ì‘ìœ„', 'ìµœì ì '}, 'Location', 'southeast');
    grid on;
else
    subplot(1, 3, 2);
    text(0.5, 0.5, 'ROC ë¶„ì„ ë¶ˆê°€', 'HorizontalAlignment', 'center');
    axis off;
end

% [3] Logistic ê³„ìˆ˜ (ìƒìœ„ 12ê°œ)
if logit_success
    subplot(1, 3, 3);
    % ì ˆëŒ€ê°’ ê¸°ì¤€ ìƒìœ„ 12ê°œ ì„ íƒ
    [~, coef_sorted_idx] = sort(abs(beta_coefficients), 'descend');
    top_n = min(12, length(coef_sorted_idx));
    top_idx = coef_sorted_idx(1:top_n);

    barh(1:top_n, beta_coefficients(top_idx), 'FaceColor', [0.3, 0.7, 0.4]);
    set(gca, 'YTick', 1:top_n, 'YTickLabel', valid_comp_cols(top_idx), 'FontSize', 9);
    xlabel('Logistic ê³„ìˆ˜');
    title('ì£¼ìš” ì—­ëŸ‰ ê³„ìˆ˜ (ìƒìœ„ 12ê°œ)');
    xline(0, '--k', 'LineWidth', 1);
    grid on;
else
    subplot(1, 3, 3);
    text(0.5, 0.5, 'ê³„ìˆ˜ ë¶„ì„ ë¶ˆê°€', 'HorizontalAlignment', 'center');
    axis off;
end

sgtitle('ì†Œí™”ì„± íŒë³„ ëª¨ë¸ ë¶„ì„ ê²°ê³¼ (LOO-CV)', 'FontSize', 16, 'FontWeight', 'bold');

% ì €ì¥
fig_file_1 = fullfile(config.output_dir, sprintf('sohwa_model_analysis_%s.png', config.timestamp));
saveas(fig, fig_file_1);
fprintf('  âœ“ ëª¨ë¸ ë¶„ì„ ì‹œê°í™” ì €ì¥: %s\n', fig_file_1);

%% Figure 2: ì ìˆ˜ ì¡°ì • ê²°ê³¼ ì‹œê°í™”
fprintf('  ì ìˆ˜ ì¡°ì • ê²°ê³¼ ì‹œê°í™” ìƒì„± ì¤‘...\n');

fig2 = figure('Position', [150, 150, 1600, 900], 'Color', 'white');

% [1] ì†Œí™”ì„± í™•ë¥  ë¶„í¬
if logit_success
    subplot(2, 3, 1);
    histogram(sohwa_probabilities(normal_idx), 20, 'FaceColor', [0.3, 0.7, 0.9], 'FaceAlpha', 0.7);
    hold on;
    histogram(sohwa_probabilities(sohwa_idx), 20, 'FaceColor', [0.9, 0.3, 0.3], 'FaceAlpha', 0.7);
    xlabel('ì†Œí™”ì„± í™•ë¥ ');
    ylabel('ë¹ˆë„');
    title('ì†Œí™”ì„± í™•ë¥  ë¶„í¬');
    legend({'ë‚˜ë¨¸ì§€', 'ì†Œí™”ì„±'}, 'Location', 'best');
    grid on;
else
    subplot(2, 3, 1);
    text(0.5, 0.5, 'í™•ë¥  ë¶„ì„ ë¶ˆê°€', 'HorizontalAlignment', 'center');
    axis off;
end

% [2] ê¸°ì¡´ ì ìˆ˜ ë¶„í¬
subplot(2, 3, 2);
histogram(base_scores(normal_idx), 20, 'FaceColor', [0.3, 0.7, 0.9], 'FaceAlpha', 0.7);
hold on;
histogram(base_scores(sohwa_idx), 20, 'FaceColor', [0.9, 0.3, 0.3], 'FaceAlpha', 0.7);
xlabel('ê¸°ì¡´ ê°€ì¤‘ì¹˜ ì ìˆ˜');
ylabel('ë¹ˆë„');
title('ê¸°ì¡´ ì ìˆ˜ ë¶„í¬');
legend({'ë‚˜ë¨¸ì§€', 'ì†Œí™”ì„±'}, 'Location', 'best');
grid on;

% [3] ì¡°ì • í›„ ì ìˆ˜ ë¶„í¬
if logit_success
    subplot(2, 3, 3);
    histogram(adjusted_scores(normal_idx), 20, 'FaceColor', [0.3, 0.7, 0.9], 'FaceAlpha', 0.7);
    hold on;
    histogram(adjusted_scores(sohwa_idx), 20, 'FaceColor', [0.9, 0.3, 0.3], 'FaceAlpha', 0.7);
    xlabel('ì¡°ì • í›„ ì ìˆ˜');
    ylabel('ë¹ˆë„');
    title('ì†Œí™”ì„± í™•ë¥  ì¡°ì • í›„ ì ìˆ˜ ë¶„í¬');
    legend({'ë‚˜ë¨¸ì§€', 'ì†Œí™”ì„±'}, 'Location', 'best');
    grid on;
else
    subplot(2, 3, 3);
    text(0.5, 0.5, 'ì¡°ì • ë¶ˆê°€', 'HorizontalAlignment', 'center');
    axis off;
end

% [4] ì ìˆ˜ ë³€í™” (Before vs After)
if logit_success
    subplot(2, 3, 4);
    scatter(base_scores(normal_idx), adjusted_scores(normal_idx), 50, 'o', ...
            'MarkerFaceColor', [0.3, 0.7, 0.9], 'MarkerEdgeColor', 'none', 'MarkerFaceAlpha', 0.5);
    hold on;
    scatter(base_scores(sohwa_idx), adjusted_scores(sohwa_idx), 100, 's', ...
            'MarkerFaceColor', [0.9, 0.3, 0.3], 'MarkerEdgeColor', 'k', 'LineWidth', 1.5);
    plot([0, 100], [0, 100], '--k', 'LineWidth', 1.5);
    xlabel('ê¸°ì¡´ ì ìˆ˜');
    ylabel('ì¡°ì • í›„ ì ìˆ˜');
    title('ì ìˆ˜ ë³€í™” (Before vs After)');
    legend({'ë‚˜ë¨¸ì§€', 'ì†Œí™”ì„±', 'ë³€í™”ì—†ìŒ'}, 'Location', 'best');
    grid on;
    axis equal;
    xlim([0, 100]);
    ylim([0, 100]);
else
    subplot(2, 3, 4);
    text(0.5, 0.5, 'ì ìˆ˜ ë³€í™” ë¶„ì„ ë¶ˆê°€', 'HorizontalAlignment', 'center');
    axis off;
end

% [5] ì ìˆ˜ ë³€í™”ëŸ‰ ë¶„í¬
if logit_success
    subplot(2, 3, 5);
    score_change = base_scores - adjusted_scores;
    histogram(score_change(normal_idx), 20, 'FaceColor', [0.3, 0.7, 0.9], 'FaceAlpha', 0.7);
    hold on;
    histogram(score_change(sohwa_idx), 20, 'FaceColor', [0.9, 0.3, 0.3], 'FaceAlpha', 0.7);
    xlabel('ì ìˆ˜ ê°ì†ŒëŸ‰ (ê¸°ì¡´ - ì¡°ì •)');
    ylabel('ë¹ˆë„');
    title('ì†Œí™”ì„± í™•ë¥  ì¡°ì •ì— ë”°ë¥¸ ì ìˆ˜ ë³€í™”');
    legend({'ë‚˜ë¨¸ì§€', 'ì†Œí™”ì„±'}, 'Location', 'best');
    grid on;
else
    subplot(2, 3, 5);
    text(0.5, 0.5, 'ë³€í™”ëŸ‰ ë¶„ì„ ë¶ˆê°€', 'HorizontalAlignment', 'center');
    axis off;
end

% [6] ê·¸ë£¹ë³„ í‰ê·  ì ìˆ˜ ë¹„êµ (ë§‰ëŒ€ ê·¸ë˜í”„)
subplot(2, 3, 6);
if logit_success
    group_names = {'ë‚˜ë¨¸ì§€', 'ì†Œí™”ì„±'};
    before_means = [mean(base_scores(normal_idx)), mean(base_scores(sohwa_idx))];
    after_means = [mean(adjusted_scores(normal_idx)), mean(adjusted_scores(sohwa_idx))];

    x = 1:2;
    width = 0.35;
    bar(x - width/2, before_means, width, 'FaceColor', [0.4, 0.6, 0.8]);
    hold on;
    bar(x + width/2, after_means, width, 'FaceColor', [0.8, 0.4, 0.4]);

    set(gca, 'XTick', x, 'XTickLabel', group_names);
    ylabel('í‰ê·  ì ìˆ˜');
    title('ê·¸ë£¹ë³„ í‰ê·  ì ìˆ˜ ë¹„êµ');
    legend({'ì¡°ì • ì „', 'ì¡°ì • í›„'}, 'Location', 'best');
    grid on;

    % ê°’ í‘œì‹œ
    for i = 1:2
        text(i - width/2, before_means(i), sprintf('%.1f', before_means(i)), ...
             'HorizontalAlignment', 'center', 'VerticalAlignment', 'bottom', 'FontSize', 9);
        text(i + width/2, after_means(i), sprintf('%.1f', after_means(i)), ...
             'HorizontalAlignment', 'center', 'VerticalAlignment', 'bottom', 'FontSize', 9);
    end
else
    bar([1, 2], [mean(base_scores(normal_idx)), mean(base_scores(sohwa_idx))]);
    set(gca, 'XTick', [1, 2], 'XTickLabel', {'ë‚˜ë¨¸ì§€', 'ì†Œí™”ì„±'});
    ylabel('í‰ê·  ì ìˆ˜');
    title('ê·¸ë£¹ë³„ í‰ê·  ì ìˆ˜ (ì¡°ì • ì „)');
    grid on;
end

sgtitle('ì†Œí™”ì„± í™•ë¥  ì¡°ì • ê¸°ë°˜ ì ìˆ˜ ë³´ì • ê²°ê³¼', 'FontSize', 16, 'FontWeight', 'bold');

% ì €ì¥
fig_file_2 = fullfile(config.output_dir, sprintf('sohwa_score_adjustment_%s.png', config.timestamp));
saveas(fig2, fig_file_2);
fprintf('  âœ“ ì ìˆ˜ ì¡°ì • ì‹œê°í™” ì €ì¥: %s\n', fig_file_2);

%% Figure 3: t-test ê²°ê³¼ ì‹œê°í™”
fprintf('  t-test ê²°ê³¼ ì‹œê°í™” ìƒì„± ì¤‘...\n');

fig3 = figure('Position', [200, 200, 1600, 1000], 'Color', 'white');

% [1] ì—­ëŸ‰ë³„ í‰ê·  ì ìˆ˜ ë¹„êµ (ìƒìœ„ 15ê°œ)
subplot(2, 3, 1);
top_n_ttest = min(15, height(ttest_results));
top_comps = ttest_results(1:top_n_ttest, :);

y_pos = 1:top_n_ttest;
barh(y_pos, [top_comps.Normal_Mean, top_comps.Sohwa_Mean], 'grouped');
set(gca, 'YTick', y_pos, 'YTickLabel', top_comps.Competency, 'FontSize', 8);
xlabel('í‰ê·  ì ìˆ˜');
title('ì—­ëŸ‰ë³„ í‰ê·  ë¹„êµ (Cohen''s d ê¸°ì¤€ ìƒìœ„ 15ê°œ)');
legend({'ë‚˜ë¨¸ì§€', 'ì†Œí™”ì„±'}, 'Location', 'best');
grid on;

% [2] Cohen's d (íš¨ê³¼í¬ê¸°)
subplot(2, 3, 2);
barh(y_pos, top_comps.Cohen_d, 'FaceColor', [0.3, 0.6, 0.8]);
set(gca, 'YTick', y_pos, 'YTickLabel', top_comps.Competency, 'FontSize', 8);
xlabel('Cohen''s d');
title('íš¨ê³¼í¬ê¸° (ì†Œí™”ì„± vs ë‚˜ë¨¸ì§€)');
xline(-0.5, '--r', 'LineWidth', 1.5, 'DisplayName', 'ì¤‘ê°„ íš¨ê³¼');
xline(-0.8, '--r', 'LineWidth', 2, 'DisplayName', 'í° íš¨ê³¼');
legend('Location', 'best');
grid on;

% [3] í‰ê·  ì°¨ì´ (ì†Œí™”ì„± - ë‚˜ë¨¸ì§€)
subplot(2, 3, 3);
bar_colors = zeros(top_n_ttest, 3);
for i = 1:top_n_ttest
    if top_comps.Mean_Diff(i) < 0
        bar_colors(i, :) = [0.8, 0.3, 0.3];  % ë¹¨ê°„ìƒ‰ (ì†Œí™”ì„±ì´ ë‚®ìŒ)
    else
        bar_colors(i, :) = [0.3, 0.7, 0.3];  % ì´ˆë¡ìƒ‰ (ì†Œí™”ì„±ì´ ë†’ìŒ)
    end
end

barh(y_pos, top_comps.Mean_Diff, 'FaceColor', 'flat', 'CData', bar_colors);
set(gca, 'YTick', y_pos, 'YTickLabel', top_comps.Competency, 'FontSize', 8);
xlabel('í‰ê·  ì°¨ì´ (ì†Œí™”ì„± - ë‚˜ë¨¸ì§€)');
title('ì—­ëŸ‰ë³„ ì ìˆ˜ ì°¨ì´');
xline(0, '--k', 'LineWidth', 1.5);
grid on;

% [4] p-value ë¶„í¬ (íˆìŠ¤í† ê·¸ë¨)
subplot(2, 3, 4);
histogram(ttest_results.p_value, 20, 'FaceColor', [0.4, 0.6, 0.8]);
hold on;
xline(0.05, '--r', 'LineWidth', 2, 'DisplayName', 'Î±=0.05');
xline(0.01, '--', 'Color', [0.8, 0.3, 0.3], 'LineWidth', 2, 'DisplayName', 'Î±=0.01');
xlabel('p-value');
ylabel('ë¹ˆë„');
title('p-value ë¶„í¬');
legend('Location', 'best');
grid on;

% [5] ìœ ì˜ì„± ë¶„í¬ (íŒŒì´ ì°¨íŠ¸)
subplot(2, 3, 5);
sig_counts = [
    sum(strcmp(ttest_results.Significance, '***'));
    sum(strcmp(ttest_results.Significance, '**'));
    sum(strcmp(ttest_results.Significance, '*'));
    sum(strcmp(ttest_results.Significance, ''))
];

pie_labels = {
    sprintf('p<0.001 (***)\n%dê°œ', sig_counts(1));
    sprintf('p<0.01 (**)\n%dê°œ', sig_counts(2));
    sprintf('p<0.05 (*)\n%dê°œ', sig_counts(3));
    sprintf('ìœ ì˜í•˜ì§€ ì•ŠìŒ\n%dê°œ', sig_counts(4))
};

pie(sig_counts, pie_labels);
title('í†µê³„ì  ìœ ì˜ì„± ë¶„í¬');
colormap([0.8, 0.2, 0.2; 0.9, 0.5, 0.3; 0.9, 0.8, 0.5; 0.7, 0.7, 0.7]);

% [6] íš¨ê³¼í¬ê¸° vs p-value (ì‚°ì ë„)
subplot(2, 3, 6);
scatter(ttest_results.Cohen_d, -log10(ttest_results.p_value), 50, 'filled', ...
        'MarkerFaceAlpha', 0.6);
hold on;

% ìœ ì˜ì„± ê¸°ì¤€ì„ 
yline(-log10(0.05), '--r', 'p=0.05', 'LineWidth', 1.5, 'LabelHorizontalAlignment', 'left');
yline(-log10(0.01), '--', 'Color', [0.8, 0.3, 0.3], 'DisplayName', 'p=0.01', ...
      'LineWidth', 1.5, 'LabelHorizontalAlignment', 'left');

% íš¨ê³¼í¬ê¸° ê¸°ì¤€ì„ 
xline(-0.5, '--', 'ì¤‘ê°„ íš¨ê³¼', 'Color', [0.5, 0.5, 0.5], 'LineWidth', 1.5, ...
      'LabelVerticalAlignment', 'bottom');
xline(-0.8, '--', 'í° íš¨ê³¼', 'Color', [0.5, 0.5, 0.5], 'LineWidth', 1.5, ...
      'LabelVerticalAlignment', 'bottom');

% ì£¼ìš” ì—­ëŸ‰ ë¼ë²¨ í‘œì‹œ (p<0.05 & |Cohen's d| > 0.5)
sig_large_idx = ttest_results.p_value < 0.05 & abs(ttest_results.Cohen_d) > 0.5;
for i = 1:height(ttest_results)
    if sig_large_idx(i)
        text(ttest_results.Cohen_d(i), -log10(ttest_results.p_value(i)), ...
             [' ' ttest_results.Competency{i}], 'FontSize', 7, ...
             'HorizontalAlignment', 'left');
    end
end

xlabel('Cohen''s d (íš¨ê³¼í¬ê¸°)');
ylabel('-log10(p-value)');
title('íš¨ê³¼í¬ê¸° vs í†µê³„ì  ìœ ì˜ì„±');
grid on;

sgtitle('ì†Œí™”ì„± vs ë‚˜ë¨¸ì§€ ê·¸ë£¹ t-test ë¶„ì„ ê²°ê³¼', 'FontSize', 16, 'FontWeight', 'bold');

% ì €ì¥
fig_file_3 = fullfile(config.output_dir, sprintf('sohwa_ttest_analysis_%s.png', config.timestamp));
saveas(fig3, fig_file_3);
fprintf('  âœ“ t-test ë¶„ì„ ì‹œê°í™” ì €ì¥: %s\n', fig_file_3);

%% ========================================================================
%                        PART 7: ê²°ê³¼ ì €ì¥
% =========================================================================

fprintf('\n\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n');
fprintf('â•‘                  PART 7: ê²°ê³¼ ì €ì¥                        â•‘\n');
fprintf('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n');

%% 7.1 ì—‘ì…€ ì €ì¥
fprintf('ã€STEP 15ã€‘ Excel ê²°ê³¼ íŒŒì¼ ìƒì„±\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

excel_file = fullfile(config.output_dir, sprintf('sohwa_integrated_results_%s.xlsx', config.timestamp));

try
    % Sheet 1: ìš”ì•½
    summary_table = table();
    summary_table.('í•­ëª©') = {'ë¶„ì„ì¼ì‹œ'; 'ì´ìƒ˜í”Œìˆ˜'; 'ì†Œí™”ì„±ìˆ˜'; 'ë‚˜ë¨¸ì§€ìˆ˜'; ...
                          'ê¸°ì¡´ì ìˆ˜í‰ê· _ì†Œí™”ì„±'; 'ê¸°ì¡´ì ìˆ˜í‰ê· _ë‚˜ë¨¸ì§€'; ...
                          'ì¡°ì •í›„í‰ê· _ì†Œí™”ì„±'; 'ì¡°ì •í›„í‰ê· _ë‚˜ë¨¸ì§€'; ...
                          'ì¡°ì •ê°•ë„'; 'Logisticì •í™•ë„'; 'Logisticì •ë°€ë„'; 'LogisticF1'};
    if logit_success
        summary_table.('ê°’') = {datestr(now); length(y_binary); n_sohwa; n_normal; ...
                           sprintf('%.2f', sohwa_base_mean); sprintf('%.2f', normal_base_mean); ...
                           sprintf('%.2f', sohwa_adjusted_mean); sprintf('%.2f', normal_adjusted_mean); ...
                           sprintf('%.2f', adjustment_strength); ...
                           sprintf('%.3f', accuracy); sprintf('%.3f', precision); sprintf('%.3f', f1)};
    else
        summary_table.('ê°’') = {datestr(now); length(y_binary); n_sohwa; n_normal; ...
                           sprintf('%.2f', mean(base_scores(sohwa_idx))); sprintf('%.2f', mean(base_scores(normal_idx))); ...
                           'N/A'; 'N/A'; 'N/A'; 'N/A'; 'N/A'; 'N/A'};
    end
    writetable(summary_table, excel_file, 'Sheet', 'ìš”ì•½');

    % Sheet 2: t-test ê²°ê³¼
    writetable(ttest_results, excel_file, 'Sheet', 't-testê²°ê³¼');

    % Sheet 3: Logistic ê³„ìˆ˜
    if logit_success
        writetable(logit_coef_table, excel_file, 'Sheet', 'Logisticê³„ìˆ˜');
    end

    % Sheet 4: Z-score ì •ê·œí™” íŒŒë¼ë¯¸í„°
    if logit_success
        writetable(zscore_params, excel_file, 'Sheet', 'Zì •ê·œí™”íŒŒë¼ë¯¸í„°');
    end

    % Sheet 5: ê°œë³„ ê²°ê³¼
    writetable(individual_results, excel_file, 'Sheet', 'ê°œë³„ê²°ê³¼');

    % Sheet 6: Excel ì ìš© ê°€ì´ë“œ
    writetable(application_guide, excel_file, 'Sheet', 'Excelì ìš©ê°€ì´ë“œ');

    % Sheet 7: ê¸°ì¡´ ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜
    if ~isempty(base_weights_table)
        writetable(base_weights_table, excel_file, 'Sheet', 'ê¸°ì¡´ì—­ëŸ‰ê²€ì‚¬ê°€ì¤‘ì¹˜');
    end

    fprintf('  âœ“ Excel ì €ì¥ ì™„ë£Œ: %s\n', excel_file);
catch ME
    fprintf('  âš  Excel ì €ì¥ ì‹¤íŒ¨: %s\n', ME.message);
end

%% 7.2 MAT íŒŒì¼ ì €ì¥
results = struct();
results.config = config;
results.ttest_results = ttest_results;
results.individual_results = individual_results;
results.base_weights_table = base_weights_table;

if logit_success
    results.logit_model = logit_model;
    results.logit_coef_table = logit_coef_table;
    results.zscore_params = zscore_params;
    results.adjustment_strength = adjustment_strength;
    results.performance = struct('accuracy', accuracy, 'precision', precision, ...
                                 'recall', recall, 'f1', f1, 'AUC', AUC);
    results.cv_results = struct('lambda_range', lambda_range, ...
                               'cv_scores', cv_scores, ...
                               'cv_aucs', cv_aucs, ...
                               'optimal_lambda', optimal_lambda, ...
                               'best_auc', best_auc);
    results.roc_data = struct('X_roc', X_roc, 'Y_roc', Y_roc, ...
                             'optimal_threshold', optimal_threshold);
end

mat_file = fullfile(config.output_dir, sprintf('sohwa_integrated_results_%s.mat', config.timestamp));
save(mat_file, 'results');
fprintf('  âœ“ MAT ì €ì¥ ì™„ë£Œ: %s\n', mat_file);

%% ========================================================================
%                          ìµœì¢… ìš”ì•½ ì¶œë ¥
% =========================================================================

fprintf('\n\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n');
fprintf('â•‘                    ìµœì¢… ìš”ì•½                              â•‘\n');
fprintf('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n');

fprintf('ã€ë¶„ì„ ê²°ê³¼ã€‘\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');
fprintf('ì´ ìƒ˜í”Œ: %dëª… (ì†Œí™”ì„±: %dëª…, ë‚˜ë¨¸ì§€: %dëª…)\n\n', ...
    length(y_binary), n_sohwa, n_normal);

fprintf('ê¸°ì¡´ ì—­ëŸ‰ê²€ì‚¬ ê°€ì¤‘ì¹˜ ì ìˆ˜:\n');
fprintf('  ì†Œí™”ì„±: %.2f Â± %.2fì \n', mean(base_scores(sohwa_idx)), std(base_scores(sohwa_idx)));
fprintf('  ë‚˜ë¨¸ì§€: %.2f Â± %.2fì \n', mean(base_scores(normal_idx)), std(base_scores(normal_idx)));
fprintf('  ì°¨ì´: %.2fì \n\n', abs(mean(base_scores(sohwa_idx)) - mean(base_scores(normal_idx))));

if logit_success
    fprintf('ì†Œí™”ì„± í™•ë¥  ì¡°ì • í›„ ì ìˆ˜:\n');
    fprintf('  ì†Œí™”ì„±: %.2f Â± %.2fì  (%.2fì  ê°ì†Œ)\n', ...
        mean(adjusted_scores(sohwa_idx)), std(adjusted_scores(sohwa_idx)), ...
        mean(base_scores(sohwa_idx)) - mean(adjusted_scores(sohwa_idx)));
    fprintf('  ë‚˜ë¨¸ì§€: %.2f Â± %.2fì  (%.2fì  ê°ì†Œ)\n', ...
        mean(adjusted_scores(normal_idx)), std(adjusted_scores(normal_idx)), ...
        mean(base_scores(normal_idx)) - mean(adjusted_scores(normal_idx)));
    fprintf('  ì°¨ì´: %.2fì \n\n', abs(mean(adjusted_scores(sohwa_idx)) - mean(adjusted_scores(normal_idx))));

    fprintf('Logistic ëª¨ë¸ ì„±ëŠ¥:\n');
    fprintf('  ì •í™•ë„: %.3f\n', accuracy);
    fprintf('  ì •ë°€ë„: %.3f\n', precision);
    fprintf('  ì¬í˜„ìœ¨: %.3f\n', recall);
    fprintf('  F1 ìŠ¤ì½”ì–´: %.3f\n\n', f1);
end

fprintf('ã€ì£¼ìš” ì†Œí™”ì„± íŠ¹ì§• ì—­ëŸ‰ (Cohen''s d ìƒìœ„ 5ê°œ)ã€‘\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');
sig_features = ttest_results(ttest_results.p_value < 0.05 & abs(ttest_results.Cohen_d) > 0.5, :);
for i = 1:min(5, height(sig_features))
    fprintf('%d. %s\n', i, sig_features.Competency{i});
    fprintf('   - ì†Œí™”ì„±: %.1fì  vs ë‚˜ë¨¸ì§€: %.1fì  (ì°¨ì´: %.1fì )\n', ...
        sig_features.Sohwa_Mean(i), sig_features.Normal_Mean(i), sig_features.Mean_Diff(i));
    fprintf('   - Cohen''s d: %.3f, p=%.4f%s\n\n', ...
        sig_features.Cohen_d(i), sig_features.p_value(i), sig_features.Significance{i});
end

fprintf('ã€Excel ì ìš© ë°©ë²•ã€‘\n');
fprintf('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');
fprintf('1. "Logisticê³„ìˆ˜" ì‹œíŠ¸ì—ì„œ ê³„ìˆ˜ í™•ì¸\n');
fprintf('2. "Zì •ê·œí™”íŒŒë¼ë¯¸í„°" ì‹œíŠ¸ì—ì„œ í‰ê· /í‘œì¤€í¸ì°¨ í™•ì¸\n');
fprintf('3. ì—­ëŸ‰ ì ìˆ˜ë¥¼ Z-scoreë¡œ ë³€í™˜\n');
fprintf('4. Logistic ê°’ ê³„ì‚°: ì ˆí¸ + Î£(Z-score Ã— ê³„ìˆ˜)\n');
fprintf('5. ì†Œí™”ì„± í™•ë¥ : 1/(1+EXP(-Logisticê°’))\n');
fprintf('6. ì¡°ì • ì ìˆ˜: ê¸°ì¡´ì ìˆ˜ Ã— (1 - ì†Œí™”ì„±í™•ë¥  Ã— ì¡°ì •ê°•ë„)\n\n');

fprintf('ì¡°ì • ê°•ë„ íŒŒë¼ë¯¸í„° (í˜„ì¬: %.2f):\n', adjustment_strength);
fprintf('  â€¢ 0.0 â†’ ì¡°ì • ì—†ìŒ (ê¸°ì¡´ ì ìˆ˜ ìœ ì§€)\n');
fprintf('  â€¢ 0.5 â†’ ì¤‘ê°„ ì¡°ì • (ê¶Œì¥)\n');
fprintf('  â€¢ 1.0 â†’ ìµœëŒ€ ì¡°ì • (ì†Œí™”ì„± í™•ë¥  100%% ë°˜ì˜)\n\n');

fprintf('âœ… ì†Œí™”ì„± ì¸ì¬ ë¶„ì„ + ê°€ì¤‘ì¹˜ í†µí•© ì™„ë£Œ!\n');
fprintf('ğŸ“Š ê²°ê³¼ ì €ì¥ ìœ„ì¹˜: %s\n', config.output_dir);
fprintf('ğŸ“ Excel íŒŒì¼: %s\n\n', excel_file);
